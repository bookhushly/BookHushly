(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6193],{9315:function(e,s,t){Promise.resolve().then(t.bind(t,5025))},2420:function(e,s,t){"use strict";t.d(s,{a:function(){return c}});var a=t(7437),r=t(2265),i=t(4033),n=t(4045),l=t(3160);function c(e){let{children:s,requiredRole:t=null}=e,{user:c,loading:o}=(0,n.tN)(),[d,u]=(0,r.useState)(!0),m=(0,i.useRouter)();return((0,r.useEffect)(()=>{let e=setTimeout(()=>{var e;if(!c){m.push("/login");return}if(t&&(null===(e=c.user_metadata)||void 0===e?void 0:e.role)!==t){m.push("/unauthorized");return}u(!1)},100);return()=>clearTimeout(e)},[c,m,t]),o||d)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)(l.T,{className:"h-8 w-8"})}):c?(0,a.jsx)(a.Fragment,{children:s}):null}},5025:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return T}});var a=t(7437),r=t(2265),i=t(4033),n=t(1396),l=t.n(n),c=t(2420),o=t(4045),d=t(5825);t(2129);var u=t(3715),m=t(3067),x=t(8063),h=t(8203),f=t(6141),p=t(5750),g=t(4530),j=t(6142),v=t(1738),y=t(9314),b=t(9311),N=t(1424),_=t(6110),w=t(2206),k=t(6672),S=t(5831),Z=t(3023),q=t(1291),P=t(7158),B=t(7015);function R(e){let{className:s,classNames:t,showOutsideDays:r=!0,...i}=e;return(0,a.jsx)(B._W,{showOutsideDays:r,className:(0,b.cn)("p-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,b.cn)((0,Z.d)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,b.cn)((0,Z.d)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:e=>{let{...s}=e;return(0,a.jsx)(q.Z,{className:"h-4 w-4"})},IconRight:e=>{let{...s}=e;return(0,a.jsx)(P.Z,{className:"h-4 w-4"})}},...i})}R.displayName="Calendar";var F=t(1908),I=t(5771),C=t(3160);function T(){var e,s;let t=(0,i.useParams)(),n=(0,i.useRouter)(),{user:q}=(0,o.tN)(),{addBooking:P}=(0,o.ML)(),[B,T]=(0,r.useState)(!1),[E,O]=(0,r.useState)(!0),[z,A]=(0,r.useState)(null),[D,L]=(0,r.useState)(""),[Y,M]=(0,r.useState)(),[J,U]=(0,r.useState)({guests:1,time:"",duration:"",special_requests:"",contact_phone:"",contact_email:(null==q?void 0:q.email)||""}),[V,X]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=async()=>{if(t.id)try{O(!0);let{data:e,error:s}=await (0,d.LR)(t.id);if(s){console.error("Error fetching listing:",s),L("Failed to load service details");return}A(e)}catch(e){console.error("Exception fetching service:",e),L("An error occurred while loading service details")}finally{O(!1)}};e()},[t.id]),(0,r.useEffect)(()=>{(null==q?void 0:q.email)&&U(e=>({...e,contact_email:q.email}))},[q]);let G=e=>{U(s=>({...s,[e.target.name]:e.target.value})),V&&X("")},W=()=>Y?J.time?J.contact_phone?J.contact_email?null==z||!z.capacity||!(J.guests>z.capacity)||(X("Maximum capacity is ".concat(z.capacity," guests")),!1):(X("Email address is required"),!1):(X("Phone number is required"),!1):(X("Please select a time"),!1):(X("Please select a date"),!1),H=()=>{if(!z)return 0;let e=z.price;return e+.05*e},K=(0,r.useRef)("book-".concat(crypto.randomUUID()));console.log("Booking reference:",K.current);let Q=async e=>{if(e.preventDefault(),W()&&z&&q){T(!0),X("");try{let e={listing_id:z.id,customer_id:q.id,booking_date:Y.toISOString().split("T")[0],booking_time:J.time,guests:parseInt(J.guests),duration:J.duration||null,special_requests:J.special_requests||null,contact_phone:J.contact_phone,contact_email:J.contact_email,total_amount:H(),status:"pending",payment_status:"pending",payment_reference:""};console.log("Booking payload â†’",e);let{data:s,error:t}=await (0,d.TB)(e);if(t){X(t.message),N.Am.error("Booking failed",{description:t.message});return}P(s),N.Am.success("Booking request submitted!",{description:"The vendor will review and confirm your booking shortly"}),n.push("/dashboard/customer?tab=bookings")}catch(e){console.error("Booking error:",e),X("An unexpected error occurred"),N.Am.error("Booking failed",{description:"An unexpected error occurred"})}finally{T(!1)}}};return E?(0,a.jsx)(c.a,{requiredRole:"customer",children:(0,a.jsx)("div",{className:"container max-w-4xl py-8",children:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(u.Z,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading service details..."})]})})})}):D||!z?(0,a.jsx)(c.a,{requiredRole:"customer",children:(0,a.jsxs)("div",{className:"container max-w-4xl py-8",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)(l(),{href:"/services",className:"inline-flex items-center text-sm text-muted-foreground hover:text-foreground",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Back to Services"]})}),(0,a.jsxs)(w.bZ,{variant:"destructive",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4"}),(0,a.jsx)(w.X,{children:D||"Service not found"})]})]})}):(0,a.jsx)(c.a,{requiredRole:"customer",children:(0,a.jsxs)("div",{className:"container max-w-4xl py-8",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)(l(),{href:"/services/".concat(t.id),className:"inline-flex items-center text-sm text-muted-foreground hover:text-foreground",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Back to Service Details"]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsxs)(_.Zb,{children:[(0,a.jsxs)(_.Ol,{children:[(0,a.jsx)(_.ll,{children:"Book This Service"}),(0,a.jsx)(_.SZ,{children:"Fill in the details below to request a booking"})]}),(0,a.jsx)(_.aY,{children:(0,a.jsxs)("form",{onSubmit:Q,className:"space-y-6",children:[V&&(0,a.jsxs)(w.bZ,{variant:"destructive",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4"}),(0,a.jsx)(w.X,{children:V})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(k._,{children:"Select Date *"}),(0,a.jsxs)(S.J2,{children:[(0,a.jsx)(S.xo,{asChild:!0,children:(0,a.jsxs)(Z.z,{variant:"outline",className:(0,b.cn)("w-full justify-start text-left font-normal",!Y&&"text-muted-foreground"),children:[(0,a.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),Y?(0,y.ZP)(Y,"PPP"):"Pick a date"]})}),(0,a.jsx)(S.yk,{className:"w-auto p-0",children:(0,a.jsx)(R,{mode:"single",selected:Y,onSelect:M,disabled:e=>e<new Date,initialFocus:!0})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(k._,{htmlFor:"time",children:"Preferred Time *"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(f.Z,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(F.I,{id:"time",name:"time",type:"time",value:J.time,onChange:G,className:"pl-10",required:!0})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(k._,{htmlFor:"duration",children:"Duration"}),(0,a.jsx)(F.I,{id:"duration",name:"duration",placeholder:z.duration||"e.g., 2 hours, 1 day",value:J.duration,onChange:G}),z.duration&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Standard duration: ",z.duration]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(k._,{htmlFor:"guests",children:"Number of Guests *"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(p.Z,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(F.I,{id:"guests",name:"guests",type:"number",min:"1",max:z.capacity||100,value:J.guests,onChange:G,className:"pl-10",required:!0})]}),z.capacity&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Maximum capacity: ",z.capacity," guests"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(k._,{htmlFor:"contact_phone",children:"Phone Number *"}),(0,a.jsx)(F.I,{id:"contact_phone",name:"contact_phone",type:"tel",value:J.contact_phone,onChange:G,required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(k._,{htmlFor:"contact_email",children:"Email Address *"}),(0,a.jsx)(F.I,{id:"contact_email",name:"contact_email",type:"email",value:J.contact_email,onChange:G,required:!0})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(k._,{htmlFor:"special_requests",children:"Special Requests (Optional)"}),(0,a.jsx)(I.g,{id:"special_requests",name:"special_requests",value:J.special_requests,onChange:G,rows:3,placeholder:"Any special requirements or requests..."})]}),(0,a.jsx)(Z.z,{type:"submit",className:"w-full",size:"lg",disabled:B,children:B?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.T,{className:"mr-2 h-4 w-4"}),"Processing Booking..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),"Submit Booking Request"]})})]})})]})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(_.Zb,{children:[(0,a.jsx)(_.Ol,{children:(0,a.jsx)(_.ll,{className:"text-lg",children:"Booking Summary"})}),(0,a.jsxs)(_.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:z.title}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["by ",(null===(e=z.vendors)||void 0===e?void 0:e.business_name)||"Service Provider"]})]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-1"}),z.location]}),Y&&(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,a.jsx)("span",{children:(0,y.ZP)(Y,"PPP")})]}),J.time&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,a.jsx)("span",{children:J.time})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,a.jsxs)("span",{children:[J.guests," guest",J.guests>1?"s":""]})]})]})]})]}),(0,a.jsxs)(_.Zb,{children:[(0,a.jsx)(_.Ol,{children:(0,a.jsxs)(_.ll,{className:"text-lg flex items-center",children:[(0,a.jsx)(v.Z,{className:"h-5 w-5 mr-2"}),"Price Details"]})}),(0,a.jsxs)(_.aY,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Service fee"}),(0,a.jsxs)("span",{children:["â‚¦",(null===(s=z.price)||void 0===s?void 0:s.toLocaleString())||"0"]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{children:"Platform fee (5%)"}),(0,a.jsxs)("span",{children:["â‚¦",(.05*(z.price||0)).toLocaleString()]})]}),(0,a.jsx)("div",{className:"border-t pt-3",children:(0,a.jsxs)("div",{className:"flex justify-between font-semibold text-lg",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsxs)("span",{children:["â‚¦",H().toLocaleString()]})]})}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Payment will be processed after vendor confirmation"})]})]}),(0,a.jsxs)(_.Zb,{children:[(0,a.jsx)(_.Ol,{children:(0,a.jsx)(_.ll,{className:"text-lg",children:"Booking Policy"})}),(0,a.jsxs)(_.aY,{className:"space-y-2 text-sm text-muted-foreground",children:[(0,a.jsx)("p",{children:"â€¢ Booking requests are subject to vendor approval"}),(0,a.jsx)("p",{children:"â€¢ Payment is processed only after confirmation"}),z.cancellation_policy?(0,a.jsxs)("p",{children:["â€¢ ",z.cancellation_policy]}):(0,a.jsx)("p",{children:"â€¢ Free cancellation up to 24 hours before service"}),(0,a.jsx)("p",{children:"â€¢ Refund policy applies as per vendor terms"})]})]})]})]})]})})}},1908:function(e,s,t){"use strict";t.d(s,{I:function(){return n}});var a=t(7437),r=t(2265),i=t(9311);let n=r.forwardRef((e,s)=>{let{className:t,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...n})});n.displayName="Input"},6672:function(e,s,t){"use strict";t.d(s,{_:function(){return o}});var a=t(7437),r=t(2265),i=t(6743),n=t(9213),l=t(9311);let c=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(i.f,{ref:s,className:(0,l.cn)(c(),t),...r})});o.displayName=i.f.displayName},5831:function(e,s,t){"use strict";t.d(s,{J2:function(){return l},xo:function(){return c},yk:function(){return o}});var a=t(7437),r=t(2265),i=t(5050),n=t(9311);let l=i.fC,c=i.xz,o=r.forwardRef((e,s)=>{let{className:t,align:r="center",sideOffset:l=4,...c}=e;return(0,a.jsx)(i.h_,{children:(0,a.jsx)(i.VY,{ref:s,align:r,sideOffset:l,className:(0,n.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...c})})});o.displayName=i.VY.displayName},5771:function(e,s,t){"use strict";t.d(s,{g:function(){return n}});var a=t(7437),r=t(2265),i=t(9311);let n=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...r})});n.displayName="Textarea"}},function(e){e.O(0,[7533,4724,2294,1424,2095,4931,8096,1181,2971,7864,1744],function(){return e(e.s=9315)}),_N_E=e.O()}]);