(()=>{var e={};e.id=3074,e.ids=[3074],e.modules={55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},19373:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>m,routeModule:()=>x,tree:()=>d});var a=s(73137),r=s(54647),n=s(4183),i=s.n(n),o=s(71775),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let c=a.AppPageRouteModule,d=["",{children:["payments",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,42489)),"C:\\Users\\D\\Downloads\\Bookhushly.com-main\\Bookhushly.com-main\\app\\payments\\page.jsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,48818)),"C:\\Users\\D\\Downloads\\Bookhushly.com-main\\Bookhushly.com-main\\app\\layout.jsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,51918,23)),"next/dist/client/components/not-found-error"]}],m=["C:\\Users\\D\\Downloads\\Bookhushly.com-main\\Bookhushly.com-main\\app\\payments\\page.jsx"],u="/payments/page",h={require:s,loadChunk:()=>Promise.resolve()},x=new c({definition:{kind:r.x.APP_PAGE,page:"/payments/page",pathname:"/payments",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},50742:(e,t,s)=>{Promise.resolve().then(s.bind(s,93949))},93949:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>A});var a=s(60080),r=s(9885),n=s(57114),i=s(97052),o=s(68384),l=s(24796),c=s(81704),d=s(84827),m=s(80850),u=s(95440),h=s(46757);let x=process.env.PAYSTACK_SECRET_KEY,p=process.env.FLUTTERWAVE_SECRET_KEY,f=async(e,t)=>{try{if("paystack"===e)return await y(t);if("flutterwave"===e)return await j(t);throw Error("Unsupported payment provider")}catch(e){return console.error("Payment initialization error:",e),{data:null,error:e}}},y=async e=>{try{if(!x)throw Error("Paystack secret key not configured");let t=await fetch("https://api.paystack.co/transaction/initialize",{method:"POST",headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"},body:JSON.stringify({email:e.email,amount:e.amount,currency:e.currency||"NGN",reference:e.reference,callback_url:e.callback_url,metadata:e.metadata,channels:["card","bank","ussd","qr","mobile_money","bank_transfer"]})}),s=await t.json();if(!t.ok)throw Error(s.message||"Payment initialization failed");return await b({reference:e.reference,booking_id:e.metadata.booking_id,customer_id:e.metadata.customer_id,amount:e.amount/100,provider:"paystack",status:"pending",payment_data:s.data}),{data:s.data,error:null}}catch(e){return console.error("Paystack initialization error:",e),{data:null,error:e}}},j=async e=>{try{if(!p)throw Error("Flutterwave secret key not configured");let t=await fetch("https://api.flutterwave.com/v3/payments",{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({tx_ref:e.reference,amount:e.amount/100,currency:e.currency||"NGN",redirect_url:e.callback_url,customer:{email:e.email,name:e.metadata.customer_name||"Customer"},customizations:{title:"Bookhushly Payment",description:`Payment for ${e.metadata.service_title}`,logo:"https://your-logo-url.com/logo.png"},meta:e.metadata})}),s=await t.json();if(!t.ok||"success"!==s.status)throw Error(s.message||"Payment initialization failed");return await b({reference:e.reference,booking_id:e.metadata.booking_id,customer_id:e.metadata.customer_id,amount:e.amount/100,provider:"flutterwave",status:"pending",payment_data:s.data}),{data:{authorization_url:s.data.link},error:null}}catch(e){return console.error("Flutterwave initialization error:",e),{data:null,error:e}}},g=async e=>{try{let t;let{data:s,error:a}=await N(e);if(a||!s)throw Error("Payment record not found");if("paystack"===s.provider)t=await w(e);else if("flutterwave"===s.provider)t=await v(e);else throw Error("Unsupported payment provider");return t.data&&"success"===t.data.status&&await _(e,{status:"completed",verified_at:new Date().toISOString(),verification_data:t.data}),t}catch(e){return console.error("Payment verification error:",e),{data:null,error:e}}},w=async e=>{try{let t=await fetch(`https://api.paystack.co/transaction/verify/${e}`,{method:"GET",headers:{Authorization:`Bearer ${x}`}}),s=await t.json();if(!t.ok)throw Error(s.message||"Payment verification failed");return{data:{status:"success"===s.data.status?"success":"failed",amount:s.data.amount/100,reference:s.data.reference,gateway_response:s.data.gateway_response},error:null}}catch(e){return{data:null,error:e}}},v=async e=>{try{let t=await fetch(`https://api.flutterwave.com/v3/transactions/verify_by_reference?tx_ref=${e}`,{method:"GET",headers:{Authorization:`Bearer ${p}`}}),s=await t.json();if(!t.ok||"success"!==s.status)throw Error(s.message||"Payment verification failed");return{data:{status:"successful"===s.data.status?"success":"failed",amount:s.data.amount,reference:s.data.tx_ref,gateway_response:s.data.processor_response},error:null}}catch(e){return{data:null,error:e}}},b=async e=>{try{let{data:t,error:s}=await h.O.from("payments").insert({...e,created_at:new Date().toISOString()}).select().single();if(s)throw s;return{data:t,error:null}}catch(e){return console.error("Create payment record error:",e),{data:null,error:e}}},N=async e=>{try{let{data:t,error:s}=await h.O.from("payments").select("*").eq("reference",e).single();if(s)throw s;return{data:t,error:null}}catch(e){return{data:null,error:e}}},_=async(e,t)=>{try{let{data:s,error:a}=await h.O.from("payments").update({...t,updated_at:new Date().toISOString()}).eq("reference",e).select().single();if(a)throw a;return{data:s,error:null}}catch(e){return{data:null,error:e}}},k=(e,t="paystack")=>new Promise((e,s)=>{"paystack"===t?s(Error("Paystack not loaded")):"flutterwave"===t&&s(Error("Flutterwave not loaded"))});var P=s(96253),S=s(34706),C=s(79803),T=s(78260),B=s(86078),E=s(38674),Z=s(44901),z=s(23294),q=s(11440),D=s.n(q),O=s(9941);function A(){let{user:e}=(0,m.tN)(),t=(0,n.useRouter)(),s=(0,n.useSearchParams)();console.log("Search Params:",s.toString());let h=s.get("booking");console.log("Booking ID:",h);let x=s.get("reference"),[p,y]=(0,r.useState)(!0),[j,w]=(0,r.useState)(!1),[v,b]=(0,r.useState)(null),[N,_]=(0,r.useState)("pending"),[q,A]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=async()=>{if(!h){A("No booking ID provided"),y(!1);return}try{let{data:e,error:t}=await (0,u.lx)(h);if(t){A("Failed to load booking details");return}b(e),x&&await $(x)}catch(e){A("An unexpected error occurred")}finally{y(!1)}};e()},[h,x]);let $=async e=>{try{let{data:t,error:s}=await g(e);if(s){_("failed"),A("Payment verification failed");return}"success"===t.status?(_("success"),await (0,u.pz)(h,"completed",e),O.Am.success("Payment successful!",{description:"Your booking has been confirmed"})):(_("failed"),A("Payment was not successful"))}catch(e){_("failed"),A("Payment verification failed")}},Y=async s=>{if(v&&e){w(!0),A("");try{let a={email:e.email,amount:100*v.total_amount,currency:"NGN",reference:`BH_${h}_${Date.now()}`,callback_url:`${window.location.origin}/payments?booking=${h}`,metadata:{booking_id:h,customer_id:e.id,service_title:v.listings?.title,customer_name:e.user_metadata?.name||"Customer"}};try{let r=await k(a,s);if("success"===r.status||"successful"===r.status){let r=await g(a.reference);if(r.data?.status==="success"){await fetch("/api/send-payment-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:e.email,bookingDetails:{customerName:e.user_metadata?.name||"Customer",serviceTitle:v.listings?.title,amount:v.total_amount.toLocaleString(),reference:a.reference,provider:s,paymentDate:new Date().toLocaleDateString(),bookingUrl:`${window.location.origin}/dashboard/customer?tab=bookings`}})}),v.contact_phone&&await fetch("/api/send-payment-sms",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:v.contact_phone,data:{serviceTitle:v.listings?.title,amount:v.total_amount.toLocaleString(),reference:a.reference}})}),v.contact_phone&&await fetch("/api/send-payment-sms",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:v.contact_phone,data:{serviceTitle:v.listings?.title,amount:v.total_amount.toLocaleString(),reference:a.reference}})}),t.push(`/payments?booking=${h}&reference=${a.reference}&status=success`);return}}}catch(e){console.log("Client-side payment failed, trying server-side:",e)}let{data:r,error:n}=await f(s,a);if(n){A(n.message),O.Am.error("Payment initialization failed");return}r.authorization_url&&(window.location.href=r.authorization_url)}catch(e){A("Payment initialization failed"),O.Am.error("Payment failed to initialize")}finally{w(!1)}}};return p?a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsx(d.T,{className:"h-8 w-8"})}):"success"===N?a.jsx("div",{className:"container max-w-2xl py-8",children:(0,a.jsxs)(i.Zb,{className:"text-center",children:[(0,a.jsxs)(i.Ol,{children:[a.jsx("div",{className:"mx-auto mb-4 text-green-500",children:a.jsx(P.Z,{className:"h-16 w-16"})}),a.jsx(i.ll,{className:"text-2xl text-green-600",children:"Payment Successful!"}),a.jsx(i.SZ,{children:"Your booking has been confirmed and payment processed"})]}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[a.jsx("h3",{className:"font-semibold mb-2",children:v?.listings?.title}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Booking Date: ",v?.booking_date]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Amount Paid: ₦",v?.total_amount?.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(o.z,{asChild:!0,className:"w-full",children:a.jsx(D(),{href:"/dashboard/customer?tab=bookings",children:"View My Bookings"})}),a.jsx(o.z,{variant:"outline",asChild:!0,className:"w-full",children:a.jsx(D(),{href:"/services",children:"Browse More Services"})})]})]})]})}):"failed"===N?a.jsx("div",{className:"container max-w-2xl py-8",children:(0,a.jsxs)(i.Zb,{className:"text-center",children:[(0,a.jsxs)(i.Ol,{children:[a.jsx("div",{className:"mx-auto mb-4 text-red-500",children:a.jsx(S.Z,{className:"h-16 w-16"})}),a.jsx(i.ll,{className:"text-2xl text-red-600",children:"Payment Failed"}),a.jsx(i.SZ,{children:"There was an issue processing your payment"})]}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[q&&a.jsx(c.bZ,{variant:"destructive",children:a.jsx(c.X,{children:q})}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(o.z,{onClick:()=>_("pending"),className:"w-full",children:"Try Again"}),a.jsx(o.z,{variant:"outline",asChild:!0,className:"w-full",children:a.jsx(D(),{href:"/dashboard/customer?tab=bookings",children:"Back to Bookings"})})]})]})]})}):v?(0,a.jsxs)("div",{className:"container max-w-4xl py-8",children:[a.jsx("div",{className:"mb-6",children:(0,a.jsxs)(D(),{href:"/dashboard/customer?tab=bookings",className:"inline-flex items-center text-sm text-muted-foreground hover:text-foreground",children:[a.jsx(C.Z,{className:"h-4 w-4 mr-2"}),"Back to Bookings"]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[(0,a.jsxs)(i.ll,{className:"flex items-center",children:[a.jsx(T.Z,{className:"mr-2 h-5 w-5"}),"Choose Payment Method"]}),a.jsx(i.SZ,{children:"Select your preferred payment provider"})]}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[q&&a.jsx(c.bZ,{variant:"destructive",children:a.jsx(c.X,{children:q})}),a.jsx(i.Zb,{className:"cursor-pointer hover:shadow-md transition-shadow",children:a.jsx(i.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(T.Z,{className:"h-6 w-6 text-blue-600"})}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Paystack"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Card, Bank Transfer, USSD"})]})]}),a.jsx(o.z,{onClick:()=>Y("paystack"),disabled:j,children:j?a.jsx(d.T,{className:"h-4 w-4"}):"Pay with Paystack"})]})})}),a.jsx(i.Zb,{className:"cursor-pointer hover:shadow-md transition-shadow",children:a.jsx(i.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:a.jsx(B.Z,{className:"h-6 w-6 text-orange-600"})}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Flutterwave"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Card, Mobile Money, Bank"})]})]}),a.jsx(o.z,{variant:"outline",onClick:()=>Y("flutterwave"),disabled:j,children:j?a.jsx(d.T,{className:"h-4 w-4"}):"Pay with Flutterwave"})]})})}),a.jsx(i.Zb,{className:"cursor-pointer hover:shadow-md transition-shadow opacity-60",children:a.jsx(i.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:a.jsx(E.Z,{className:"h-6 w-6 text-green-600"})}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Mobile Money"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"MTN, Airtel, 9mobile"})]})]}),a.jsx(l.C,{variant:"secondary",children:"Coming Soon"})]})})})]})]}),(0,a.jsxs)(i.Zb,{children:[a.jsx(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center",children:[a.jsx(Z.Z,{className:"mr-2 h-5 w-5 text-green-600"}),"Secure Payment"]})}),a.jsx(i.aY,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(z.Z,{className:"h-4 w-4 text-green-600"}),a.jsx("span",{children:"256-bit SSL Encryption"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(Z.Z,{className:"h-4 w-4 text-green-600"}),a.jsx("span",{children:"PCI DSS Compliant"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(P.Z,{className:"h-4 w-4 text-green-600"}),a.jsx("span",{children:"Verified Merchants"})]})]})})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(i.Zb,{children:[a.jsx(i.Ol,{children:a.jsx(i.ll,{children:"Booking Summary"})}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"font-semibold",children:v.listings?.title}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["by ",v.listings?.vendors?.business_name]})]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Booking Date:"}),a.jsx("span",{children:v.booking_date})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Time:"}),a.jsx("span",{children:v.booking_time})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Guests:"}),a.jsx("span",{children:v.guests})]})]}),(0,a.jsxs)("div",{className:"border-t pt-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Service Fee:"}),(0,a.jsxs)("span",{children:["₦",(v.total_amount/1.05).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,",")]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"Platform Fee (5%):"}),(0,a.jsxs)("span",{children:["₦",(.05*v.total_amount/1.05).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,",")]})]}),(0,a.jsxs)("div",{className:"flex justify-between font-semibold text-lg border-t pt-2",children:[a.jsx("span",{children:"Total:"}),(0,a.jsxs)("span",{children:["₦",v.total_amount?.toLocaleString()]})]})]})]})]}),(0,a.jsxs)(i.Zb,{children:[a.jsx(i.Ol,{children:a.jsx(i.ll,{className:"text-lg",children:"Payment Policy"})}),(0,a.jsxs)(i.aY,{className:"space-y-2 text-sm text-muted-foreground",children:[a.jsx("p",{children:"• Payment is processed securely through our partners"}),a.jsx("p",{children:"• Refunds available as per vendor cancellation policy"}),a.jsx("p",{children:"• Payment confirmation sent via email and SMS"}),a.jsx("p",{children:"• 24/7 customer support for payment issues"})]})]})]})]})]}):a.jsx("div",{className:"container max-w-2xl py-8",children:a.jsx(i.Zb,{children:(0,a.jsxs)(i.aY,{className:"text-center py-12",children:[a.jsx(S.Z,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Booking Not Found"}),a.jsx("p",{className:"text-muted-foreground mb-4",children:"The booking you're trying to pay for could not be found."}),a.jsx(o.z,{asChild:!0,children:a.jsx(D(),{href:"/dashboard/customer",children:"Back to Dashboard"})})]})})})}},42489:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>l});var a=s(17536);let r=(0,a.createProxy)(String.raw`C:\Users\D\Downloads\Bookhushly.com-main\Bookhushly.com-main\app\payments\page.jsx`),{__esModule:n,$$typeof:i}=r,o=r.default,l=o}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[4650,977,1823,6026,7997,5964,1704,3692],()=>s(19373));module.exports=a})();